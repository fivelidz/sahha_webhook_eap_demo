"use strict";(()=>{var e={};e.id=948,e.ids=[948],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},73154:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>u,patchFetch:()=>g,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>c,staticGenerationAsyncStorage:()=>d});var r={};a.r(r),a.d(r,{GET:()=>l});var o=a(49303),s=a(88716),n=a(60670),i=a(87070);async function l(e){try{let{searchParams:t}=new URL(e.url),a=t.get("profileId"),r=t.get("orgId");if(console.log("\uD83D\uDD0D Demographic API Route: Starting demographic data fetch",{profileId:a,orgId:r}),!process.env.SAHHA_CLIENT_ID||!process.env.SAHHA_CLIENT_SECRET)return console.error("âŒ Missing Sahha credentials"),i.NextResponse.json({error:"Missing Sahha credentials"},{status:500});console.log("\uD83D\uDD10 Authenticating with Sahha...");let o=await fetch("https://sandbox-api.sahha.ai/oauth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:process.env.SAHHA_CLIENT_ID,clientSecret:process.env.SAHHA_CLIENT_SECRET})});if(!o.ok)return console.error("âŒ Sahha authentication failed:",o.status),i.NextResponse.json({error:"Authentication failed"},{status:401});let{accessToken:s}=await o.json();console.log("âœ… Authentication successful");let n=[];if(a){console.log("\uD83D\uDCCA Fetching specific profile demographic data for:",a);let e={profileId:a,externalId:a.substring(0,8),age:Math.floor(50*Math.random())+20,gender:Math.random()>.5?"female":"male",dateOfBirth:new Date(1970+Math.floor(35*Math.random()),Math.floor(12*Math.random()),Math.floor(28*Math.random())+1).toISOString().split("T")[0]};return i.NextResponse.json({demographic:e})}if(r){console.log("\uD83D\uDCCA Fetching organizational profiles for demographic analysis");let e=await fetch(`https://sandbox-api.sahha.ai/api/v1/profile?organizationId=${r}`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!e.ok)return console.error("âŒ Failed to fetch profiles:",e.status),i.NextResponse.json({error:"Failed to fetch profiles"},{status:500});n=(await e.json()).profiles||[],console.log(`ðŸ“Š Found ${n.length} profiles, generating demographic data...`);let t=n.map(e=>{let t=e.profileId.split("").reduce((e,t)=>e+t.charCodeAt(0),0),a=(e,a=0)=>{let r=1e4*Math.sin(t+a);return Math.floor((r-Math.floor(r))*e)},r=20+a(50,1),o=0===a(2,2)?"male":"female",s=new Date().getFullYear()-r,n=a(12,3),i=a(28,4)+1,l=`${s}-${String(n+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;return{profileId:e.profileId,externalId:e.externalId,age:r,gender:o,dateOfBirth:l}});return i.NextResponse.json({demographics:t,totalProfiles:n.length,message:"Simulated demographic data generated for all profiles"})}return i.NextResponse.json({error:"Missing profileId or orgId parameter"},{status:400})}catch(e){return console.error("âŒ Demographic API error:",e),i.NextResponse.json({error:"Failed to fetch demographic data",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/sahha/demographics/route",pathname:"/api/sahha/demographics",filename:"route",bundlePath:"app/api/sahha/demographics/route"},resolvedPagePath:"/home/fivelidz/sahha_work/sahha-marketing-intelligence/projects/EAP/deployment-package/app/api/sahha/demographics/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:c}=p,u="/api/sahha/demographics/route";function g(){return(0,n.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,972],()=>a(73154));module.exports=r})();