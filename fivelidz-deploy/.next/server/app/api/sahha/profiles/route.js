"use strict";(()=>{var e={};e.id=204,e.ids=[204],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},55484:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>h,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>c});var o=r(49303),a=r(88716),n=r(60670),i=r(87070),l=r(29712);async function c(e){let{searchParams:t}=new URL(e.url),r="true"===t.get("includeScores");try{console.log("\uD83D\uDD0D Fetching individual Sahha profiles...");let t=e.headers,s=t.get("X-Client-Id")||process.env.SAHHA_CLIENT_ID,o=t.get("X-App-Secret")||process.env.SAHHA_CLIENT_SECRET;if(!s||!o)return console.error("❌ Missing credentials"),i.NextResponse.json({success:!1,error:"Missing API credentials"},{status:401});console.log("\uD83D\uDD11 Using credentials:",{clientId:s?.substring(0,8)+"..."});let a=(await l.Z.post(`${process.env.NEXT_PUBLIC_SAHHA_API_BASE_URL}/api/v1/oauth/account/token`,{clientId:s,clientSecret:o},{headers:{"Content-Type":"application/json"}})).data.accountToken;console.log("✅ Authentication successful");let n=(await l.Z.get(`${process.env.NEXT_PUBLIC_SAHHA_API_BASE_URL}/api/v1/account/profile/search`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},params:{pageSize:100,currentPage:1}})).data.items||[];if(console.log(`📊 Found ${n.length} profiles from Sahha API`),n.length>0&&console.log("\uD83D\uDCDD Sample profile from Sahha:",{id:n[0].id,externalId:n[0].externalId,createdDateTime:n[0].createdDateTime,isSampleProfile:n[0].isSampleProfile}),!r)return i.NextResponse.json({success:!0,profiles:n,data:n,count:n.length,timestamp:new Date().toISOString()});console.log("\uD83D\uDD0D Fetching health scores for each profile...");let c=await Promise.all(n.map(async e=>{try{let t=await p(a,e.externalId,"wellbeing"),r=await p(a,e.externalId,"activity"),s=await p(a,e.externalId,"sleep"),o=await p(a,e.externalId,"mental wellbeing"),n=await p(a,e.externalId,"readiness");return console.log(`📊 Scores for ${e.externalId}: W=${t}, A=${r}, S=${s}, M=${o}, R=${n}`),{...e,scores:{wellbeing:t,activity:r,sleep:s,mentalHealth:o,readiness:n},hasRealScores:!!(t||r||s||o||n)}}catch(t){return console.log(`⚠️ Could not fetch scores for profile ${e.externalId}:`,t instanceof Error?t.message:t),{...e,scores:{wellbeing:null,activity:null,sleep:null,mentalHealth:null,readiness:null},hasRealScores:!1}}})),u=c.filter(e=>e.hasRealScores);return console.log(`✅ Successfully fetched scores for ${u.length}/${n.length} profiles`),i.NextResponse.json({success:!0,profiles:c,data:c,count:c.length,totalProfiles:n.length,timestamp:new Date().toISOString()})}catch(e){return console.error("❌ Profile fetching error:",e.message),i.NextResponse.json({success:!1,error:"Failed to fetch profiles",details:e.message,timestamp:new Date().toISOString()},{status:500})}}async function p(e,t,r){try{let s=(await l.Z.get(`${process.env.NEXT_PUBLIC_SAHHA_API_BASE_URL}/api/v1/profile/score/${t}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},params:{types:r}})).data;if(s&&s.length>0){let e=s[s.length-1].score;return Math.round(100*e)}return null}catch(e){return e.response?.status===400?console.log(`⚠️ Score type "${r}" validation error for ${t}`):e.response?.status===404?console.log(`⚠️ Profile or score not found for ${t}`):console.log(`⚠️ Score fetch error for ${t}:`,e.response?.status),null}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/sahha/profiles/route",pathname:"/api/sahha/profiles",filename:"route",bundlePath:"app/api/sahha/profiles/route"},resolvedPagePath:"/home/fivelidz/sahha_work/sahha-marketing-intelligence/projects/EAP/deployment-package/app/api/sahha/profiles/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:g}=u,f="/api/sahha/profiles/route";function m(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,712],()=>r(55484));module.exports=s})();