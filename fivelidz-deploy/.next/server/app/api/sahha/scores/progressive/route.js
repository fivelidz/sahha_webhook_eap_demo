"use strict";(()=>{var e={};e.id=92,e.ids=[92],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},5733:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>m,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var t={};s.r(t),s.d(t,{POST:()=>p});var o=s(49303),a=s(88716),i=s(60670),n=s(87070),l=s(29712);async function p(e){try{let{profiles:r,includeSubScores:s=!1}=await e.json();if(!r||!Array.isArray(r))return n.NextResponse.json({success:!1,error:"Profiles array is required"},{status:400});console.log(`üîç Progressive loading scores for ${r.length} profiles...`);let t=(await l.Z.post(`${process.env.NEXT_PUBLIC_SAHHA_API_BASE_URL}/api/v1/oauth/account/token`,{clientId:process.env.SAHHA_CLIENT_ID,clientSecret:process.env.SAHHA_CLIENT_SECRET},{headers:{"Content-Type":"application/json"}})).data.accountToken,o=[];for(let e=0;e<r.length;e+=5){let a=r.slice(e,e+5);console.log(`üìä Processing batch ${Math.floor(e/5)+1}/${Math.ceil(r.length/5)}`),(await Promise.allSettled(a.map(async e=>await c(t,e,s)))).forEach((e,r)=>{let s=a[r];"fulfilled"===e.status?o.push(e.value):o.push({profileId:s.id,externalId:s.externalId,scores:{},status:"error",error:e.reason?.message||"Unknown error"})}),e+5<r.length&&await new Promise(e=>setTimeout(e,200))}let a=o.filter(e=>"completed"===e.status).length;return console.log(`‚úÖ Progressive loading completed: ${a}/${r.length} profiles with scores`),n.NextResponse.json({success:!0,results:o,totalProfiles:r.length,successfulProfiles:a,timestamp:new Date().toISOString()})}catch(e){return console.error("‚ùå Progressive score loading error:",e.message),n.NextResponse.json({success:!1,error:"Failed to load scores progressively",details:e.message,timestamp:new Date().toISOString()},{status:500})}}async function c(e,r,s){let t={},o={};try{let a=["wellbeing","activity","sleep","mental wellbeing","readiness"].map(async a=>{try{let i=(await l.Z.get(`${process.env.NEXT_PUBLIC_SAHHA_API_BASE_URL}/api/v1/profile/score/${r.externalId}`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},params:{types:a}})).data;if(i&&i.length>0){let e=i[i.length-1],r="mental wellbeing"===a?"mentalWellbeing":a;return t[r]=Math.round(100*e.score),s&&(o[r]=i),{scoreType:a,success:!0,value:t[r]}}return{scoreType:a,success:!1,reason:"No score data"}}catch(e){return{scoreType:a,success:!1,reason:e.message}}});return await Promise.all(a),{profileId:r.id,externalId:r.externalId,scores:t,biomarkers:s?o:void 0,status:"completed"}}catch(e){return{profileId:r.id,externalId:r.externalId,scores:{},status:"error",error:e.message}}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/sahha/scores/progressive/route",pathname:"/api/sahha/scores/progressive",filename:"route",bundlePath:"app/api/sahha/scores/progressive/route"},resolvedPagePath:"/home/fivelidz/sahha_work/sahha-marketing-intelligence/projects/EAP/deployment-package/app/api/sahha/scores/progressive/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:g}=u,m="/api/sahha/scores/progressive/route";function x(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[276,972,712],()=>s(5733));module.exports=t})();